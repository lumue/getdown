<script>
	(function() {

		function postTask(){
			return {type: 'POST_TASK'}
		}

		function addTasks(urls){
			return dispatch =>{
				postTask()
				fetch("http://localhost:8001/api/tasks", {
					method: "POST",
					headers: {
						'Accept': 'application/json, text/plain, */*',
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(urls)
				})
					.then(response => response.json())
					.then(json=> dispatch(tasksAdded(json)))
			}
		}

		function requestTasks() {
			return {
				type: 'REQUEST_TASKS'
			}
		}

		function receiveTasks(json) {
			return {
				type: 'RECEIVE_TASKS',
				tasks: json.content,
				receivedAt: Date.now()
			}
		}

		function tasksAdded(json) {
			return {
				type: 'TASKS_ADDED',
				tasks: json.content,
				receivedAt: Date.now()
			}
		}

		function fetchTasks() {
			return dispatch => {
				dispatch(requestTasks())
				return fetch('http://localhost:8001/api/tasks')
					.then(response => response.json())
					.then(json => dispatch(receiveTasks( json)))
			}
		}

		GetdownConsole.actions = {
			fetchTasks,
			addTasks
		}

	}());
</script>