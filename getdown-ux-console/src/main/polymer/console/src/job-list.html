<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/vaadin-progress-bar/vaadin-progress-bar.html">
<link rel="import" href="../bower_components/vaadin-material-theme/vaadin-grid.html">
<link rel="import" href="../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="../bower_components/vaadin-grid/vaadin-grid-column.html">
<link rel="import" href="../bower_components/vaadin-grid/vaadin-grid-sorter.html">
<link rel="import" href="redux-store.html">

<dom-module id="job-list">
	<template>
		<style is="custom-style" >
            :host {
                display: block;

                padding: 10px;
	            --material-body-font-size: 11px;

            }

            .toolbar{
	            display: flex;
	            flex-direction: row-reverse
            }


		</style>

		<div class="toolbar">
			<paper-icon-button icon="cancel" on-tap="_handleCancelTap" hidden$="[[_hideCancel]]"></paper-icon-button>
			<paper-icon-button icon="refresh" on-tap="_handleRestartTap" hidden$="[[_hideRefresh]]"></paper-icon-button>
			<paper-icon-button icon="delete" on-tap="_handleDeleteTap" hidden$="[[_hideDelete]]"></paper-icon-button>
		</div>



		<vaadin-grid id="grid" items="[[jobs]]"  selected-items="{{_selectedItems}}" size="40">
			<vaadin-grid-selection-column auto-select>
			</vaadin-grid-selection-column>
			<vaadin-grid-column resizable>
				<template class="header">
					<vaadin-grid-sorter path="name">Name</vaadin-grid-sorter>
				</template>
				<template >[[item.name]]</template>
			</vaadin-grid-column>
			<vaadin-grid-column>
				<template class="header"><vaadin-grid-sorter path="state">State</vaadin-grid-sorter></template>
				<template>[[item.state]]</template>
			</vaadin-grid-column>
			<vaadin-grid-column>
				<template class="header">Progress</template>
				<template>
					<span>[[_percentage(item.size,item.progress)]]%</span>
					<vaadin-progress-bar style="width: 100%"
					                value="[[_percentage(item.size,item.progress)]]" max="100"
					                id="paper_progress">
					</vaadin-progress-bar>
				</template>
			</vaadin-grid-column>
			<vaadin-grid-column resizable>
				<template class="header">Last message</template>
				<template>[[item.message]]</template>
			</vaadin-grid-column>
		</vaadin-grid>

	</template>


	<script>
		class JobList extends GetdownConsole.ReduxMixin(Polymer.Element) {

			static get is() {
				return 'job-list';
			}

			static get properties() {
				return {
					jobs:{
						type: Array,
						statePath: 'jobsReducer.jobs'
					},
					_hideCancel:{
						type: Boolean,
						computed: 'isSelectionEmpty(_selectedItems)',
						notify: true,
						reflectToAttribute: true
					},
					_hideRefresh:{
						type: Boolean,
						computed: 'isSelectionEmpty(_selectedItems)',
						notify: true,
						reflectToAttribute: true
					},
					_hideDelete:{
						type: Boolean,
						computed: 'isSelectionEmpty(_selectedItems)',
						notify: true,
						reflectToAttribute: true
					},
					_selectedItems:{
						type:Array,
						notify: true,
						value: []
					}
				}
			}

			connectedCallback(){
				super.connectedCallback()
				this.dispatch('fetchJobs')
			}

			_percentage(gw,pw){
				return Math.round(((pw/gw)*100)*100)/100
			}

			isSelectionEmpty(items){
				return !items
						||
						(!items.length>0)
			}


		}

		window.customElements.define(JobList.is, JobList);
	</script>
</dom-module>
